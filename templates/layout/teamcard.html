{% comment %} Inside teamcard.html {% endcomment %}
{% load timer_tags %}

<div class="card" style="background-color: transparent;">
    <div class="card-body">
        <h5 class="card-title" style="font-size: 4rem;">{{ round_team.team.number }} -- {{ round_team.team.team.name }}</h5>
        <div class="table-responsive">
            <table class="table w-100" style="font-size: 3rem; border-collapse: collapse; background-color: transparent;">
                <thead>
                    <tr>
                        <th class="col" style="border: 10px solid #ddd; padding: 12px; text-align: center; font-weight: bold; color: #333; background-color: transparent;">Drivers</th>
                        <th class="col" style="border: 10px solid #ddd; padding: 12px; text-align: center; font-weight: bold; color: #333; background-color: transparent;">Drive Time</th>
                        <th class="col" style="border: 10px solid #ddd; padding: 12px; text-align: center; font-weight: bold; color: #333; background-color: transparent;">Current Session</th>
                    </tr>
                </thead>
                <tbody>
                    {% for member in round_team.team_member_set.all %}
                        {% if member.driver %}
                            <tr id="driver-row-{{ member.id }}" data-driver-id="{{ member.id }}" data-ontrack="{{ member.ontrack|yesno:'true,false' }}" data-team-id="{{ round_team.id }}">
                                <td style="border: 10px solid #ddd; padding: 12px; text-align: center; font-weight: bold; color: #333; background-color: transparent;">{{ member.member.nickname }}</td>
                                <td style="border: 10px solid #ddd; padding: 12px; text-align: center; font-weight: bold; color: #333; background-color: transparent;">
                                    {% timer_widget "total-time-"|add:member.id|stringformat:"s" "totaltime" member %}
                                </td>
                                <td style="border: 10px solid #ddd; padding: 12px; text-align: center; font-weight: bold; color: #333; background-color: transparent;" id="session-cell-{{ member.id }}">
                                    {# Always render the session timer widget #}
                                    {# The JS will hide/show its content via visibility style #}
                                    {# The template tag should set initialPaused based on member.ontrack #}
                                    {% timer_widget "session-time-"|add:member.id|stringformat:"s" "sessiontime" member %}

                                    {# Example of how you might visually hide if not ontrack initially #}
                                    {# This could also be done by adding a class based on data-ontrack #}
                                    <style>
                                      #session-time-{{ member.id }}:not([style*="visibility: visible"]) {
                                          visibility: {% if not member.ontrack %}hidden{% else %}visible{% endif %};
                                      }
                                    </style>

                                </td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
